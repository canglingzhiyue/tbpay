// @preserve @ali/pha-bridge v0.1.0 Built at 2021-06-15 21:03:49
!function(){function e(){}function t(e){return"undefined"===e}var n=t(typeof globalThis)?t(typeof self)?new Function("return this")():self:globalThis;function r(e,t){Object.defineProperty(n,t,{enumerable:!0,value:e})}var a=t(typeof __pha_environment__)?t(typeof PHAEnvironment)?{}:PHAEnvironment:__pha_environment__,i="iOS"===a.osName,o=!t(typeof window)&&"onload"in window,s=!t(typeof a.__enable_new_js_api__)&&a.__enable_new_js_api__,c=n.__nativeCreateTimer__,u=n.__nativeDeleteTimer__;function f(e){return t(typeof n[e])}function l(e,t){var r=e[0];if("string"==typeof r)r=new Function(r);else if("function"!=typeof r)return-1;var a=0|e[1],i=[].slice.call(e,2);return c((function(){try{r.apply(n,i)}catch(e){console.error(e.stack),"function"==typeof n.onerror&&n.onerror(e)}}),a,t)}var _=f("setTimeout")?function(){return l(arguments,!1)}:n.setTimeout,p=f("setInterval")?function(){return l(arguments,!1)}:n.setInterval,v=f("setTimeout")?function(e){u(0|e)}:n.clearTimeout,d=f("clearTimeout")?v:n.clearInterval,g={},b=1,y={};function h(e,t,n,r){if("string"==typeof e){"function"==typeof t&&"function"==typeof n?(n=t,r=successCb,t=null):"object"!=typeof t&&(t=null);var a=e+"##"+b++;"function"!=typeof n&&"function"!=typeof r||(g[a]={success:n,fail:r});var i={callbackId:a,handlerName:e,data:t};__nativeMessageQueue__(e,JSON.stringify(i))}}t(typeof __jsbridge__)&&r({},"__jsbridge__"),__jsbridge__.callJS=function(e){var t="string"==typeof e?JSON.parse(e):e;if("call"===t.msgType){var n=t.func,r=t.param||{};r.callbackId=t.callbackId,function(e,t){if(y[e])for(var n=0;n<y[e].length;n++)y[e][n].fn(t)}(n,r)}else{var a=g[t.callbackId];"boolean"==typeof t.keepCallback&&t.keepCallback||delete g[t.callbackId],"object"==typeof a&&("success"===t.status?a.success&&a.success(t.param):"fail"===t.status&&a.fail&&a.fail(t.param))}};var m={__proto__:null,callNative:h,on:function(e,t){y[e]||(y[e]=[]),y[e].push({fn:t})},off:function(e,t){if(y[e])for(var n=0;n<y[e].length;n++)if(t===y[e][n].fn){y[e].splice(n,1),0===y[e].length&&delete y[e];break}},callBridge:function(e,t,n,r){h("bridge."+e,t,n,r)},setAppData:function(e){__phaAppData__(e)}},k=n.__nativeLog__,T=n.__nativeLogError__,E=n.__nativeLogWarn__;function j(){try{for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];t>0&&(e+=" "),n instanceof Error?e+=n.message+"\n"+n.stack:e+="object"==typeof n?JSON.stringify(n):n}k(e)}catch(e){k("Error: ",e)}}var w=i?k:j,L=i?E:j;var O={__proto__:null,log:w,info:w,debug:w,warn:L,error:i?T:j,assert:function(){arguments[0]||L("Assertion failed:",[].slice.call(arguments).slice(1))}},P=1,I={},N=C("__pha_js_to_native__")?function(e,n,r,a){i?function(e,t,n,r){var a={refId:e,class:t,method:n};r&&(a.params=r);var i=window.webkit.messageHandlers.phaMessageHandler;i&&i.postMessage(a)}(e,n,r,a):function(e,n,r,a){t(typeof __pha_bridge_engine__)||__pha_bridge_engine__.call(e,n,r,JSON.stringify(a))}(e,n,r,a)}:n.__pha_js_to_native__,S=C("__pha_native_to_js__")?function(e,t,n){A(e,t,n)}:n.__pha_native_to_js__;function C(e){return t(typeof n[e])}function A(e,t,n){var r=I[e];r&&(r.timeout&&clearTimeout(r.timeout),t?(r.failureCallback(t),console.log("onFailure "+e+", "+JSON.stringify(t))):(r.successCallback(n),console.log("onSuccess "+e)),delete I[e])}function J(){return o?i?!t(typeof window.webkit.messageHandlers.phaMessageHandler):!t(typeof __pha_bridge_engine__):!t(typeof __pha_worker_bridge__)}function U(e,n,r,a){if("string"==typeof e){var i=e.split(".");if(2===i.length)!function(e,n,r,a,i){try{if(o){if("string"!=typeof e)return void H(i,"invalid group name");if("string"!=typeof n)return void H(i,"invalid method name");"object"!=typeof r&&(r={}),"function"!=typeof a&&(a=null),"function"!=typeof i&&(i=null);var s=function(e,t){return e+"."+t+"##"+P++}(e,n);!function(e,t,n){(t||n)&&(I[e]={successCallback:t,failureCallback:n,timeout:setTimeout((function(){A(e,{message:"time out"},null)}),3e4)})}(s,a,i),N(s,e,n,r)}else t(typeof __pha_worker_bridge__)||__pha_worker_bridge__(e,n,r,a,i)}catch(e){console.error(e)}}(i[0],i[1],n,r,a);else H(a,"invalid APIName")}else H(a,"invalid APIName")}function H(e,t){"function"==typeof e?e(new Error(t)):console.error(t)}var M,x,B={__proto__:null,available:J,invokeMethod:U};function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var W=function(e,t){this.type=e,t=t||{},this.bubbles=t.bubbles||!1,this.cancelable=t.cancelable||!1,this.composed=t.composed||!1},V=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,n||{})||this).detail=n?n.detail:null,r}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,F(t,n),r}(W),D=function(){function e(){this._resetEventListeners()}var t=e.prototype;return t._resetEventListeners=function(){this._eventListeners={}},t.addEventListener=function(e,t){"function"==typeof t&&(e=Q(e),this._eventListeners[e]||(this._eventListeners[e]=[]),-1===this._eventListeners[e].indexOf(t)&&this._eventListeners[e].push(t))},t.removeEventListener=function(e,t){if(e=Q(e),"function"==typeof t&&this._eventListeners[e]){var n=this._eventListeners[e].indexOf(t);n>-1&&this._eventListeners[e].splice(n,1)}},t.dispatchEvent=function(e){var t;if(t=this._eventListeners[e.type]){e.currentTarget=e.target=this,e._dispatchFlag=!0;for(var n=!0;null!=e.currentTarget&&(n=this._dispatchEvent(e,t),!e.bubbles&&!n);)if(e.currentTarget){var r=e.currentTarget;e.currentTarget=r.parentNode}return e._dispatchFlag=!1,!e.defaultPrevented}},t._dispatchEvent=function(e,t){for(var n=0;n<t.length;n++)t[n].call(this,e);return!e._canceledFlag},e}();function Q(e){return String(e)}var q={get bundleUrl(){return t(typeof bundleUrl)?t(typeof a.manifestUrl)?null:a.manifestUrl:bundleUrl},get env(){return a}},z=["navigator.back","navigationBar.showMenu","navigationBar.setMoreItems","navigationBar.setTitle","userTrack.click","userTrack.pageEnter","userTrack.expose","userTrack.updateNextProp","userTrack.updatePageUtparam","userTrack.other","userTrack.custom","userTrack.pageAppear","userTrack.pageDisappear","userTrack.updateNextPageUtparam","userTrack.skipPage"];var G={};function K(e,t){e&&"function"==typeof t&&(G[e]=t)}function R(e,t,n){return"[object Object]"!==Object.prototype.toString.call(n)||("setItem"===t&&(n.value=String(n.value)),n.key=String(n.key)),n}K("storage.setItem",R),K("storage.getItem",R),K("storage.removeItem",R);var X=G,Y={};Object.assign(Y,m),Object.defineProperty(Y,"environment",{enumerable:!0,get:function(){return a}}),Object.defineProperty(Y,"postMessage",{enumerable:!0,get:function(){return function(e,t){return Y.message.post({message:e,targetOrigin:t})}}}),Object.defineProperty(Y,"addEventListener",{enumerable:!0,get:function(){return addEventListener}}),Y.config=q,Object.defineProperty(Y,"console",{enumerable:!0,get:function(){return o?n.console:O}}),s&&t(typeof console)&&!o&&!i&&Object.defineProperty(n,"console",{enumerable:!0,get:function(){return O}});var Z,$=o?function(){return x||(t(typeof WindVane)?void console.warn("Cannot find WindVane, please check."):x=function(e,t,n,r,a){return WindVane.call("PHABridge",e+"_"+t,n,r,a)})}:function(){return M||(t(typeof __pha_bridge__)?null:M=__pha_bridge__)};function ee(e){return function(t){return e(function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){console.warn("Can not parse JSON String, raw: "+e),console.warn(t)}return e}(t))}}if(!t(typeof __pha_APIList__)){var te=__pha_APIList__;[].forEach.call(te,(function(n){if("string"==typeof n){var r=n.split(".");if(2==r.length){var a=r[0],c=r[1];a&&c&&(Y[a]||(Y[a]={}),Object.defineProperty(Y[a],c,{enumerable:!0,get:function(){return function(r,u,f){if(void 0===u&&(u=e),void 0===f&&(f=e),"function"==typeof X[n]&&(r=X[n](a,c,r)),!s||!J()){if(function(e,n,r,a,i){var o=e+"."+n;return!!z.includes(o)&&("navigator.back"===o?o="navigationBar.back":"userTrack.updateNextPageUtparam"===o&&(o="userTrack.updateNextPageUtParam"),t(typeof WindVane)?console.warn("Call "+o+" fail, due to bridge not found."):WindVane.call("PHAJSBridge",o,r,a,i),!0)}(a,c,r,u,f))return;return function(e,t,n,r,a){var s=$();if(s)return i||o||(r=ee(r),a=ee(a)),s(e,t,n,r,a);console.warn("Call "+e+"."+t+" fail, due to bridge not found.")}(a,c,r,u,f)}i||(u=ee(u),f=ee(f)),U(n,r,u,f)}}}))}}}))}function ne(){return Z||(Z=new D)}r(Y,"pha"),r(B,"methodChannel"),t(typeof Event)&&r(W,"Event"),t(typeof CustomEvent)&&r(V,"CustomEvent"),t(typeof EventTarget)&&r(D,"EventTarget"),r(_,"setTimeout"),r(p,"setInterval"),r(v,"clearTimeout"),r(d,"clearInterval"),o&&r(S,"__pha_native_to_js__"),t(typeof addEventListener)&&r(ne().addEventListener.bind(Z),"addEventListener"),t(typeof removeEventListener)&&r(ne().removeEventListener.bind(Z),"removeEventListener"),t(typeof dispatchEvent)&&r(ne().dispatchEvent.bind(Z),"dispatchEvent")}();
